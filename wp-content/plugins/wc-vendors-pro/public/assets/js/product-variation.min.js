jQuery(function(a){var t={},i=[],e={create_variation_drop_down:function(t,i,e,n){var o="attribute_"+t+"["+n+"]",r="variation_attribute "+t,_=a("<select></select>").attr("name",o).attr("class",r).data("taxonomy",t);return _.append('<option value="">'+wcv_frontend_product_variation.i18n_any_label+" "+e+"</option>"),a.each(i,function(a,t){_.append('<option value="'+a+'">'+t+"</option>")}),_},create_defaults_drop_down:function(t,i,e){var n="default_attribute_"+t,o=t,r=a("<select></select>").attr("name",n).attr("class",o).data("current","").data("taxonomy",t);return r.append('<option value="">'+wcv_frontend_product_variation.i18n_any_label+" "+e+"</option>"),a.each(i,function(a,t){r.append('<option value="'+a+'">'+t+"</option>")}),r},sort_select_terms:function(t){var i=t;if(i.length>0){var e=i.val(),n=a("option",i),o=[];n.each(function(){o.push({val:a(this).val(),text:a(this).text()})}),o.sort(function(a,t){return a.val>t.val?1:a.val==t.val?0:-1});for(var r=0,_=o.length;r<_;r++)a(n[r]).val(o[r].val).text(o[r].text);return i.val(e),i}},update_variation_select_positions:function(){var t=a("#wcv-variation-attributes").data("variation_attr");a(".wcv_variation").each(function(){var i=a(this).find("select.variation_attribute");i.sort(function(i,e){var n=t[a(i).data("taxonomy")].position,o=t[a(e).data("taxonomy")].position;return n>o?1:n<o?-1:0}),i.detach().appendTo(a(this).find("span.variations_wrapper"))})},update_default_select_positions:function(){var t=a("#wcv-variation-attributes").data("variation_attr"),i=a(".variation_default_values").find("select.default_attribute");i.sort(function(i,e){var n=t[a(i).data("taxonomy")].position,o=t[a(e).data("taxonomy")].position;return n>o?1:n<o?-1:0}),i.detach().appendTo(".variation_default_values")}},n={init:function(){a("#wcv_variable_product_options").on("change","input.variable_is_downloadable",this.variable_is_downloadable).on("change","input.variable_is_virtual",this.variable_is_virtual).on("change","input.variable_manage_stock",this.variable_manage_stock).on("click","button.notice-dismiss",this.notice_dismiss).on("click","h5 .wcv-sort",this.set_menu_order).on("reload",this.reload),a("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock").change(),a(document.body).on("wcv_variations_added",this.variation_added)},reload:function(){r.load_variations(1),this.variation_options},variable_is_downloadable:function(){a(this).closest(".wcv_variation").find(".show_if_variation_downloadable").hide(),a(this).is(":checked")&&a(this).closest(".wcv_variation").find(".show_if_variation_downloadable").show()},variable_is_virtual:function(){a(this).closest(".wcv_variation").find(".hide_if_variation_virtual").show(),a(this).is(":checked")&&a(this).closest(".wcv_variation").find(".hide_if_variation_virtual").hide()},variable_manage_stock:function(){a(this).closest(".wcv_variation").find(".show_if_variation_manage_stock").hide(),a(this).is(":checked")&&a(this).closest(".wcv_variation").find(".show_if_variation_manage_stock").show()},notice_dismiss:function(){a(this).closest("div.notice").remove()},update_input:function(t,i){return a("."+i).val(t),!1},adjust_price:function(t,i,e){return a(".wcv_variation ."+t).each(function(t,n){var o=0,r=parseFloat(a(this).attr("value")),_=0;if((r.length<=0||isNaN(r))&&(r=0),i.indexOf("%")>=0){o=parseFloat(i.replace("%",""));var c=o/100*parseFloat(r);_="+"==e?parseFloat(r)+c:parseFloat(r)-c}else o=parseFloat(i),_="+"==e?parseFloat(r)+o:parseFloat(r)-o;(_<0||isNaN(_))&&(_=0),a(this).attr("value",_)}),!1},variations_loaded:function(t,i){i=i||!1;var e=a("#wcv_variable_product_options");i||(a("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock",e).change(),a(".wcv_variation",e).each(function(t,i){var e=a(i),n=a(".sale_price_dates_from",e).val(),o=a(".sale_price_dates_to",e).val();""===n&&""===o||a("a.sale_schedule",e).click()})),a(".wcv_variations",e).sortable({items:".wcv_variation",cursor:"move",axis:"y",handle:".wcv-sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(){n.variation_row_indexes()}})},variation_added:function(a,t){1===t&&n.variations_loaded(null,!0)},set_menu_order:function(t){t.preventDefault();var i=a(this).closest(".wcv_variation").find(".variation_menu_order"),e=window.prompt(wcv_frontend_product_variation.i18n_enter_menu_order,i.val());null!=e&&(i.val(parseInt(e,10)).change(),r.save_variations())},variation_row_indexes:function(){var t=a("#wcv_variable_product_options").find(".wcv_variations"),i=parseInt(t.attr("data-page"),10),e=parseInt((i-1)*wcv_frontend_product_variation.variations_per_page,10);a(".wcv_variations .wcv_variation").each(function(t,i){a(".variation_menu_order",i).val(parseInt(a(i).index(".wcv_variations .wcv_variation"),10)+1+e).change()})}},o={setting_variation_image:null,init:function(){a("#wcv_variable_product_options").on("click",".upload_image_button",this.add_image)},add_image:function(t){var i,e,n=a(this),r=(n.attr("rel"),n.closest(".upload_image"));if(o.setting_variation_image=r,t.preventDefault(),n.is(".wcv_remove"))a(".upload_image_id",o.setting_variation_image).val("").change(),o.setting_variation_image.find("img").eq(0).attr("src",wcv_frontend_product_variation.wcv_woocommerce_placeholder_img_src),o.setting_variation_image.find(".upload_image_button").removeClass("wcv_remove");else{if(void 0!==i)return void i.open();i=wp.media({title:wcv_frontend_product_variation.i18n_choose_image,button:{text:wcv_frontend_product_variation.i18n_set_image},states:[new wp.media.controller.Library({title:wcv_frontend_product_variation.i18n_choose_image,filterable:"all"})]}),i.on("select",function(){e=i.state().get("selection").first().toJSON(),0>a.trim(e.url.length)||(attachment_url=e.sizes.thumbnail?e.sizes.thumbnail.url:e.url,a(".upload_image_id",o.setting_variation_image).val(e.id).change(),o.setting_variation_image.find(".upload_image_button").addClass("wcv_remove"),o.setting_variation_image.find("img").eq(0).attr("src",attachment_url))}),i.open()}},restore_wp_media_post_id:function(){wp.media.model.settings.post.id=a("#post_id").val()}},r={init:function(){a("#wcv_variable_product_options").on("click",".remove_variation",this.remove_variation),a(document.body).on("change","#wcv_variable_product_options .wcv_variations :input",this.input_changed).on("change",".variations-defaults select",this.defaults_changed),a(".wcv-metaboxes-wrapper").on("click","a.do_variation_action",this.do_variation_action),a("a.variations").on("click",this.check_for_attribute_changes),a(document).ready(function(){var t=a("#wcv-variation-attributes").data("variation_attr");a.isEmptyObject(i)&&(i=a.extend({},t))})},check_for_attribute_changes:function(){var t=a("#wcv-variation-attributes").data("variation_attr");if(a.isEmptyObject(i)&&(i=a.extend({},t)),JSON.stringify(i)!=JSON.stringify(t)){if(JSON.stringify(i).length==JSON.stringify(t).length)e.update_variation_select_positions(),e.update_default_select_positions();else if(JSON.stringify(i).length>JSON.stringify(t).length)if(Object.keys(i).length==Object.keys(t).length)a.each(i,function(i,e){var n=_.omit(e.values,Object.keys(t[i].values));a.isEmptyObject(n)||r.update_variations_ui(i,n,"term","-")});else{var n=_.omit(i,Object.keys(t));a.each(n,function(a,t){r.update_variations_ui(a,t,"attribute","-"),r.update_defaults_ui(a,t,"attribute","-")})}else if(JSON.stringify(i).length<JSON.stringify(t).length)if(Object.keys(i).length==Object.keys(t).length)a.each(t,function(t,e){var n=_.omit(e.values,Object.keys(i[t].values));a.isEmptyObject(n)||r.update_variations_ui(t,n,"term","+")});else{var o=_.omit(t,Object.keys(i));a.each(o,function(a,t){r.update_variations_ui(a,t,"attribute","+"),r.update_defaults_ui(a,t,"attribute","+")})}i=jQuery.extend({},t)}jQuery.isEmptyObject(t)?(a(".variations-toolbar").hide(),a(".variations_notice").show()):(a(".variations-toolbar").show(),a(".variations_notice").hide()),r.check_total_variations()},update_variations_ui:function(t,i,n,o){a("#wcv-variation-attributes").data("variation_attr");r.block();a(".wcv_variation").each(function(r,_){switch(n){case"attribute":if("-"==o)a(this).find("select."+t).remove();else{var c=e.create_variation_drop_down(t,i.values,i.label,r);a(this).find(".variation_title").append(c),e.update_variation_select_positions(),e.update_default_select_positions()}break;case"term":if("-"==o){var s=a(this).find("select."+t);a.each(i,function(a,t){s.find('[value="'+a+'"]').remove()})}else{var s=a(this).find("select."+t);a.each(i,function(t,i){s.append(a("<option></option>").attr("value",t).text(i))}),s=e.sort_select_terms(s)}}}),r.unblock()},update_defaults_ui:function(t,i,n,o){switch(n){case"attribute":if("-"==o)a(".variations-defaults").find("select."+t).remove();else{var r=e.create_defaults_drop_down(t,i.values,i.label);a(".variation_default_values").append(r),e.update_variation_select_positions(),e.update_default_select_positions()}break;case"term":if("-"==o){var _=a(this).find("select."+t);a.each(i,function(a,t){_.find('[value="'+a+'"]').remove()})}else{var _=a(this).find("select."+t);a.each(i,function(t,i){_.append(a("<option></option>").attr("value",t).text(i))}),_=e.sort_select_terms(_)}}},check_total_variations:function(){var t=a(".wcv_variation").length;return 0==t&&a(".variations-defaults").remove(),!1},block:function(){a("#wcv_variable_product_options").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#wcv_variable_product_options").unblock()},load_default_attributes:function(){if(0==a(".wcv_variation").length){console.log(a("#wcv-variation-attributes").data("variation_attr"));var t={action:"wcv_json_default_variation_attributes",attributes:a("#wcv-variation-attributes").data("variation_attr"),security:wcv_frontend_product_variation.wcv_add_variation_nonce};a.post(wcv_frontend_product_variation.ajax_url,t,function(t){var i=a(t);a(".toolbar-variations-defaults").prepend(i),a(".toolbar-variations-defaults").show()})}},add_variation:function(){r.block();var i={action:"wcv_json_add_variation",loop:a(".wcv_variation").size(),parent_data:t,attributes:a("#wcv-variation-attributes").data("variation_attr"),security:wcv_frontend_product_variation.wcv_add_variation_nonce};return a.post(wcv_frontend_product_variation.ajax_url,i,function(t){var i=a(t);r.load_default_attributes(),a("#wcv_variable_product_options").find(".wcv_variations").prepend(i),a("#wcv_variable_product_options").trigger("wcv_variations_added",1),r.unblock()}),!1},remove_variation:function(){if(window.confirm(wcv_frontend_product_variation.i18n_remove_variation)){var t=a(this).parent().parent().parent().parent(),i=t.attr("rel"),e=t.data("loop");return t.remove(),r.add_deleted_variation(i,e),c.update_variations_count(-1),r.check_total_variations(),!1}},add_deleted_variation:function(t,i){if(0!=t){var e=a("#wcv_deleted_variations").data("variations"),n={};return jQuery.isEmptyObject(e)&&(e=[]),n.loop=i,n.id=t,e.push(n),a("#wcv_deleted_variations").data("variations",e),a("#wcv_deleted_variations").val(JSON.stringify(e)),!1}},delete_all_variations:function(){return a(".wcv_variation").each(function(){var t=a(this).attr("rel"),i=a(this).data("loop");a(this).remove(),r.add_deleted_variation(t,i),c.update_variations_count(-1),r.check_total_variations()}),!1},link_all_variations:function(){if(window.confirm(wcv_frontend_product_variation.i18n_link_all_variations)){r.block();var i=[],e=a(".wcv_variation").size();a(".wcv_variation").each(function(t,e){var n={},o=a(this).find(".variation_attribute").filter(function(){return""===this.value});return!!o.length||(a(this).find(".variation_attribute").each(function(){n[a(this).attr("name").split("[")[0]]=a(this).val()}),void i.push(n))});var n={action:"wcv_json_link_all_variations",parent_data:t,loop:a(".wcv_variation").size(),attributes:a("#wcv-variation-attributes").data("variation_attr"),available_variations:i,security:wcv_frontend_product_variation.wcv_json_link_all_variations_nonce};return a.post(wcv_frontend_product_variation.ajax_url,n,function(t){var i=a(t);r.load_default_attributes(),a("#wcv_variable_product_options").find(".wcv_variations").prepend(i);var n=parseInt(a(".wcv_variation").length)-parseInt(e);1===n?window.alert(n+" "+wcv_frontend_product_variation.i18n_variation_added):0===n||n>1?window.alert(n+" "+wcv_frontend_product_variation.i18n_variations_added):window.alert(wcv_frontend_product_variation.i18n_no_variations_added),c.update_variations_count(n),r.unblock()}),!1}},input_changed:function(){a(this).closest(".wcv_variation").addClass("variation-needs-update"),a("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),a("#wcv_variable_product_options").trigger("wcv_variations_input_changed")},populate_parent:function(){t.title=a("#post_title").val(),t.sku=a("#_sku").val(),t.weight=a("#_weight").val(),t.length=a("#_length").val(),t.width=a("#_width").val(),t.height=a("#_height").val(),t.tax_status=a("#_tax_status").val()},defaults_changed:function(){a(this).closest("#wcv_variable_product_options").find(".wcv_variation:first").addClass("variation-needs-update"),a("#wcv_variable_product_options").trigger("wcv_variations_defaults_changed")},do_variation_action:function(){var t,i=a("select.variation_actions").val(),e={};switch(r.populate_parent(),i){case"add_variation":return void r.add_variation();case"link_all_variations":return void r.link_all_variations();case"delete_all":window.confirm(wcv_frontend_product_variation.i18n_delete_all_variations)&&window.confirm(wcv_frontend_product_variation.i18n_last_warning)&&r.delete_all_variations();break;case"toggle_variable_enabled":case"toggle_variable_is_downloadable":case"toggle_variable_is_virtual":case"toggle_variable_manage_stock":var o=i.replace(/toggle_/,"");a("."+o).prop("checked",!a("."+o).prop("checked")),a("."+o).trigger("change");break;case"variable_regular_price_increase":case"variable_regular_price_decrease":case"variable_sale_price_increase":case"variable_sale_price_decrease":if(t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value_fixed_or_percent)){var _=i.indexOf("increase")>-1?"+":"-",c=i.indexOf("increase")>-1?i.substring(0,i.indexOf("_increase")):i.substring(0,i.indexOf("_decrease"));null!=t&&(t=t.indexOf("%")>=0?accounting.unformat(t.replace(/\%/,""),wcv_frontend_product_variation.mon_decimal_point)+"%":accounting.unformat(t,wcv_frontend_product_variation.mon_decimal_point)),n.adjust_price(c,String(t),_)}break;case"variable_regular_price":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),n.update_input(t,"variable_regular_price");break;case"variable_sale_price":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),n.update_input(t,"variable_sale_price");break;case"variable_stock":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),n.update_input(t,"variable_stock");break;case"variable_weight":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),n.update_input(t,"variable_weight");break;case"variable_length":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),n.update_input(t,"variable_length");break;case"variable_width":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),n.update_input(t,"variable_width");break;case"variable_height":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),n.update_input(t,"variable_height");break;case"variable_download_limit":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),n.update_input(t,"variable_download_limit");break;case"variable_download_expiry":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),n.update_input(t,"variable_download_expiry");break;case"variable_sale_schedule":date_from=window.prompt(wcv_frontend_product_variation.i18n_scheduled_sale_start),date_to=window.prompt(wcv_frontend_product_variation.i18n_scheduled_sale_end),null===date_from&&(date_from=!1),n.update_input(date_from,"sale_price_dates_from"),null===date_to&&(date_to=!1),n.update_input(date_to,"sale_price_dates_to");break;default:a("select.variation_actions").trigger(i),e=a("select.variation_actions").triggerHandler(i+"_ajax_data",e)}}},c={init:function(){a(document.body).on("wcv_variations_added",this.update_single_quantity)},update_variations_count:function(t){var i=a("#wcv_variable_product_options").find(".wcv_variations"),e=parseInt(i.attr("data-total"),10)+t,n=a(".variations-pagenav .displaying-num");return i.attr("data-total",e),1===e?n.text(wcv_frontend_product_variation.i18n_variation_count_single.replace("%qty%",e)):n.text(wcv_frontend_product_variation.i18n_variation_count_plural.replace("%qty%",e)),e},update_single_quantity:function(t,i){if(1===i){var e=a(".variations-pagenav");c.update_variations_count(i),e.is(":hidden")&&(a("option, optgroup",".variation_actions").show(),a(".variation_actions").val("add_variation"),a("#wcv_variable_product_options").find(".toolbar").show(),e.show(),a(".pagination-links",e).hide())}}};a(".wcv_product_variations").on("click","h5.variation_title",function(t){a(t.target).filter(":input, option, .wcv-sort").length||a(this).parent().parent().parent().find(".wcv-metabox-content").stop().slideToggle()}).on("click",".expand_all",function(){return a(this).closest(".wcv-metaboxes-wrapper").find(".wcv-metabox > .wcv-metabox-content").show(),!1}).on("click",".close_all",function(){return a(this).closest(".wcv-metaboxes-wrapper").find(".wcv-metabox > .wcv-metabox-content").hide(),!1}),a(".wcv_product_variations").on("click",".downloadable_files a.insert",function(){return a(this).closest(".downloadable_files").find("tbody").append(a(this).data("row")),!1}),a(".wcv_product_variations").on("click",".downloadable_files a.delete",function(){return a(this).closest("tr").remove(),!1}),a(".wcv_product_variations").on("click",".sale_schedule",function(){return a(".sale_price_dates_fields").show(),a(this).hide(),a(".cancel_sale_schedule").show(),!1}),a(".wcv_product_variations").on("click",".cancel_sale_schedule",function(){return a(".sale_price_dates_fields").hide(),a(this).hide(),a(".sale_schedule").show(),!1}),n.init(),o.init(),r.init(),c.init()});